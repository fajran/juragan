{% extends "toko/base.html" %}

{% block extraheaders %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="/+media/juragan.js"></script>
{% if posisi %}
<script type="text/javascript">
$(document).ready(function() {
    var pos = new google.maps.LatLng({{ posisi.lat }}, {{ posisi.lng }});
    juragan.init($('#peta'));
    juragan.show(pos);
});
</script>
{% endif %}
{% endblock %}


{% block content %}

{% if posisi %}
<div id="dekat">
<h2>Distributor Terdekat</h2>
<p>Asal: {{ posisi.alamat }}</p>
<p>Beberapa distributor terdekat dengan lokasi Anda:</p>
<ol>
    {% for toko in dekat %}
    <li><span onclick="juragan.showToko({{ toko.id }});">{{ toko.nama }}</span> 
        [<a href="/toko/{{ toko.id }}/">info</a>]
        &raquo; {{ toko.alamat }}, {{ toko.kota }}, {{ toko.nama_provinsi }}</li>
    {% endfor %}
</ol>
<div id="peta"></div>
</div>
{% endif %}

<h2>Cari Distributor</h2>

<div id="cari">
<form method="post" action="/cari/">
<p><strong>Lokasi Anda</strong>:</p>
<p><label>Alamat:</label> {{ form.alamat }}</p>
<p><label>Kota:</label> {{ form.kota }}</p>
<p><label>Provinsi:</label> {{ form.provinsi }}</p>
<p><input type="submit" value="Cari"/></p>
</form>
</div>

{% if not posisi %}
<script type="text/javascript">
$(document).ready(function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {  
            url = '/lokasi/' + position.coords.latitude + ',' + position.coords.longitude + '/';
            $.getJSON(url, function(json) {
                var lokasi = json.lokasi;
                $('#cari *[name="kota"]').get(0).value = lokasi.kota;
                $('#cari *[name="alamat"]').get(0).value = lokasi.alamat;
                $('#cari *[name="provinsi"]').get(0).value = lokasi.provinsi;
            });
        });  
    };
});
</script>
{% endif %}

{% endblock %}

